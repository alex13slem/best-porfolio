---
export const prerender = false;

import AdminLayout from '@/layouts/admin-layout.astro';
import { createAstroServerClient } from '@/lib/supabase/createAstroServerClient';

import { getMainInfo } from '@/lib/drizzle/queries/main-info';
import MainInfoForm from '@/components/forms/main-info-form';
import SeoFragment from '@/components/seo-fragment.astro';

const supabase = createAstroServerClient(Astro);
const {
  data: { user },
} = await supabase.auth.getUser();
if (!user) {
  console.log('User is not logged in');
  return Astro.redirect('/auth/login');
}

const mainInfoData = await getMainInfo();
---

<AdminLayout>
  <SeoFragment
    slot="seo"
    title="Админка"
    imageUrls={{ fb: '' }}
    noindex
  />
  <MainInfoForm
    defaultValues={mainInfoData.at(0)}
    method={mainInfoData.length ? 'edit' : 'create'}
    client:only="react"
  />
</AdminLayout>
